#!/usr/bin/env python

import argparse
# import multiprocessing
import os.path as osp
import shlex
import subprocess
import tempfile


def speed_up_video_with_mencoder(video_file, times, out_file):
    cmd = 'mencoder -speed {times} -o {out_file} -oac pcm -ovc copy {in_file}'
    cmd = cmd.format(
        in_file=video_file,
        times=times,
        out_file=out_file,
    )

    print('+ %s' % cmd)
    subprocess.call(shlex.split(cmd))


def speed_up_video(video_file, times):
    base, ext = osp.splitext(video_file)
    out_file = base + '_x{times}'.format(times=times) + ext

    speed_up_video_with_mencoder(video_file, times, out_file)


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('video_files', nargs='+', help='File to convert.')
    parser.add_argument('-x', '--times', type=int, required=True,
                        help='How many times to speed/slow up/down the video.')
    args = parser.parse_args()

    video_files = args.video_files
    times = args.times

    for file_ in video_files:
        speed_up_video(video_file=file_, times=times)


if __name__ == '__main__':
    main()
